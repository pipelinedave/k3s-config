apiVersion: toolhive.stacklok.dev/v1alpha1
kind: MCPServer
metadata:
  name: fetch
  namespace: toolhive-system
  labels:
    app.kubernetes.io/name: fetch
    app.kubernetes.io/instance: fetch
    app.kubernetes.io/component: mcp-server
    app.kubernetes.io/part-of: toolhive
    app.kubernetes.io/managed-by: toolhive-operator
spec:
  # Image from the curated registry
  image: mcp/fetch:latest
  
  # Transport method - stdio is standard for most MCP servers
  transport: stdio
  
  # No environment variables needed for fetch server
  env: []
  
  # Security: Use built-in network permission profile  
  permissionProfile:
    type: builtin
    name: network  # Allows outbound connections for fetching websites
  
  # Resource limits for security and stability
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "200m"
      memory: "256Mi"
  
  # Override security context to fix permission issues
  securityContext:
    runAsUser: 1000  # Use a standard user ID instead of 65534
    runAsGroup: 1000
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false  # Allow writing to filesystem for executables
    capabilities:
      drop:
        - ALL
